<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 7.6.1+81b6d3c32c77aeecc29c4700d2123bd2fb3401c2"><meta name=description content="Welcome! In this section, we’ll begin with a fully functional OpenTelemetry setup that includes both an Agent and a Gateway.
We’ll start by quickly reviewing their configuration files to get familiar with the overall structure and to highlight key sections that control the telemetry pipeline.
Tip Throughout the workshop, you’ll work with multiple terminal windows. To keep things organized, give each terminal a unique name or color. This will help you easily recognize and switch between them during the exercises."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="1. Agent/Gateway Configuration :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Welcome! In this section, we’ll begin with a fully functional OpenTelemetry setup that includes both an Agent and a Gateway.
We’ll start by quickly reviewing their configuration files to get familiar with the overall structure and to highlight key sections that control the telemetry pipeline.
Tip Throughout the workshop, you’ll work with multiple terminal windows. To keep things organized, give each terminal a unique name or color. This will help you easily recognize and switch between them during the exercises."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.95/en/conf/1-advanced-collector/1-agent-gateway/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="1. Agent/Gateway Configuration :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Welcome! In this section, we’ll begin with a fully functional OpenTelemetry setup that includes both an Agent and a Gateway.
We’ll start by quickly reviewing their configuration files to get familiar with the overall structure and to highlight key sections that control the telemetry pipeline.
Tip Throughout the workshop, you’ll work with multiple terminal windows. To keep things organized, give each terminal a unique name or color. This will help you easily recognize and switch between them during the exercises."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="1. Agent/Gateway Configuration :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Welcome! In this section, we’ll begin with a fully functional OpenTelemetry setup that includes both an Agent and a Gateway.
We’ll start by quickly reviewing their configuration files to get familiar with the overall structure and to highlight key sections that control the telemetry pipeline.
Tip Throughout the workshop, you’ll work with multiple terminal windows. To keep things organized, give each terminal a unique name or color. This will help you easily recognize and switch between them during the exercises."><meta itemprop=dateModified content="2025-06-09T16:10:16+01:00"><meta itemprop=wordCount content="917"><title>1. Agent/Gateway Configuration :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.95/en/conf/1-advanced-collector/1-agent-gateway/index.html rel=canonical type=text/html title="1. Agent/Gateway Configuration :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.95/images/favicon.ico?1751388568 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.95/css/auto-complete/auto-complete.min.css?1751388568 rel=stylesheet><script src=/observability-workshop/v5.95/js/auto-complete/auto-complete.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/search-lunr.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/search.min.js?1751388568 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v5.95/searchindex.en.js?1751388568"</script><script src=/observability-workshop/v5.95/js/lunr/lunr.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/lunr/lunr.stemmer.support.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/lunr/lunr.multi.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/lunr/lunr.en.min.js?1751388568 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v5.95/fonts/fontawesome/css/fontawesome-all.min.css?1751388568 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.95/fonts/fontawesome/css/fontawesome-all.min.css?1751388568 rel=stylesheet></noscript><link href=/observability-workshop/v5.95/css/perfect-scrollbar/perfect-scrollbar.min.css?1751388568 rel=stylesheet><link href=/observability-workshop/v5.95/css/theme.min.css?1751388568 rel=stylesheet><link href=/observability-workshop/v5.95/css/format-print.min.css?1751388568 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/conf/1-advanced-collector/1-agent-gateway/index.html",window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.95",window.relearn.version_js_url="/observability-workshop/v5.95/versionindex.en.js?1751388568",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"Z8JjZ8iNiF4jSfNHvJIRJg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"Z8JjZ8iNiF4jSfNHvJIRJg"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v5.95/en/conf/1-advanced-collector/1-agent-gateway/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#understanding-the-agent-configuration>Understanding the Agent configuration</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.95/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Splunk .conf25 Workshops</span><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.95/en/conf/1-advanced-collector/index.html><span itemprop=name>Advanced Collector Configuration</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>1. Agent/Gateway Configuration</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.95/en/conf/1-advanced-collector/1-agent-gateway/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.95/en/conf/1-advanced-collector/prerequisites/index.html title="Pre-requisites (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.95/en/conf/1-advanced-collector/1-agent-gateway/1-1-gateway/index.html title="1.1 Gateway Configuration (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable conf" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=1-agentgateway-configuration>1. Agent/Gateway Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Welcome! In this section, we’ll begin with a fully functional OpenTelemetry setup that includes both an <strong>Agent</strong> and a <strong>Gateway</strong>.</p><p>We’ll start by quickly reviewing their configuration files to get familiar with the overall structure and to highlight key sections that control the telemetry pipeline.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Throughout the workshop, you’ll work with multiple terminal windows. To keep things organized, give each terminal a unique name or color. This will help you easily recognize and switch between them during the exercises.</p><p>We will refer to these terminals as: <strong>Agent</strong>, <strong>Gateway</strong>, <strong>Spans</strong>, <strong>Logs</strong>, and <strong>Tests</strong>.</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ol><li><p>Create your first terminal window and name it <strong>Agent</strong>. Navigate to the directory for the first exercise <code>[WORKSHOP]/1-agent-gateway</code> and verify that the required files have been generated:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> 1-agent-gateway
</span></span><span class=line><span class=cl>ls -l</span></span></code></pre></div></li><li><p>You should see the following files in the directory. If not, re-run the <code>setup-workshop.sh</code> script as described in the <strong>Pre-requisites</strong> section:</p><div class=tab-panel data-tab-group=9135e7dd07687df77ba1384ea4e9c200><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9135e7dd07687df77ba1384ea4e9c200","directory-structure")'>
<span class=tab-nav-text>Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></li><li><p>Check the contents of the <strong>agent.yaml</strong> file. This file outlines the core structure of the OpenTelemetry Collector as deployed in <strong>Agent</strong> mode:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    cat ./agent.yaml</span></span></code></pre></div></li><li><p>You will see a pre-configured setup tailored for this workshop:</p><div class=tab-panel data-tab-group=cd80f4a8b1690ca60305cbe79c8e1d1d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agentyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cd80f4a8b1690ca60305cbe79c8e1d1d","agentyaml")'>
<span class=tab-nav-text>agent.yaml</span></button></div><div class=tab-content-container><div data-tab-item=agentyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################            This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##            configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################            used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                            </span><span class=c># Array of Extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                        </span><span class=c># Configures the health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>            </span><span class=c># Endpoint to collect health check data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>                             </span><span class=c># Array of Receivers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                         </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s        </span><span class=w> </span><span class=c># Scrape metrics every hour</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>                          </span><span class=c># Array of hostmetric scrapers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                             </span><span class=c># Scraper for cpu metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                                </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>                         </span><span class=c># list of Protocols used </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                            </span><span class=c># This wil enable the HTTP Protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>       </span><span class=c># Endpoint for incoming telemetry data </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                             </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                               </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed               </span><span class=w> </span><span class=c># Enabled detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                            </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>  </span><span class=c># Gateway OTLP endpoint  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file</span><span class=p>:</span><span class=w>                                </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./agent.out&#34;</span><span class=w>                </span><span class=c># Save path (OTLP JSON)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                      </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                            </span><span class=c># Array of Processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                      </span><span class=c># Limits memory usage by Collectors pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s                </span><span class=w> </span><span class=c># Interval to check memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                     </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection</span><span class=p>:</span><span class=w>                   </span><span class=c># Processor Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]               </span><span class=w> </span><span class=c># Detect system resource information</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>override</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                     </span><span class=c># Overwrites existing attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>                   </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>                        </span><span class=c># Array of attributes and modifications</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert                  </span><span class=w> </span><span class=c># Action is to insert a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode       </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=w>                   </span><span class=c># Key value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################            This section controls what</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###            configurations will be used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################            by this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                               </span><span class=c># Services configured for this Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>                          </span><span class=c># Enabled extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                           </span><span class=c># Array of configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hostmetrics                   </span><span class=w> </span><span class=c># Hostmetric reciever (cpu only)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes                </span><span class=w> </span><span class=c># Filelog Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></div></div></div></li></ol></div></details><h3 id=understanding-the-agent-configuration>Understanding the Agent configuration</h3><p>Let’s review the key components of the <code>agent.yaml</code> file used in this workshop. We’ve made some important additions to support metrics, traces, and logs.</p><h4 id=receivers>Receivers</h4><p>The <code>receivers</code> section defines how the <strong>Agent</strong> ingests telemetry data. In this setup, three types of receivers have been configured:</p><ul><li><p><strong>Host Metrics Receiver</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                         </span><span class=c># Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s        </span><span class=w> </span><span class=c># Collection Interval (1hr)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                             </span><span class=c># CPU Scraper</span></span></span></code></pre></div><p>Collects CPU usage from the local system every hour. We’ll use this to generate example metric data.</p></li><li><p><strong>OTLP Receiver (HTTP protocol)</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otlp</span><span class=p>:</span><span class=w>                                </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>                            </span><span class=c># Configure HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>       </span><span class=c># Endpoint to bind to</span></span></span></code></pre></div><p>Enables the agent to receive metrics, traces, and logs over HTTP on port <code>4318</code>. This is used to send data to the collector in future exercises.</p></li><li><p><strong>FileLog Receiver</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span></span></span></code></pre></div><p>Enables the agent to tail a local log file (<code>quotes.log</code>) and convert it to structured log events, enriched with metadata such as <code>source</code> and <code>sourceType</code>.</p></li></ul><h4 id=exporters>Exporters</h4><ul><li><p>The <code>exporters</code> section controls where the collected telemetry data is sent:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>                             </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                               </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed               </span><span class=w> </span><span class=c># Enabled detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                            </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>  </span><span class=c># Gateway OTLP endpoint  </span></span></span></code></pre></div><p>The <code>debug</code> exporter sends data to the console for visibility and debugging during the workshop while the <code>otlphttp</code> exporter forwards all telemetry to the local <strong>Gateway</strong> instance.</p></li></ul><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>This dual-export strategy ensures you can see the raw data locally while also sending it downstream for further processing and export.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1. Agent/Gateway Configuration</h1><article class=default><header class=headline></header><h1 id=11-gateway-configuration>1.1 Gateway Configuration</h1><p>The <strong>OpenTelemetry Gateway</strong> serves as a central hub for receiving, processing, and exporting telemetry data. It sits between your telemetry sources (such as applications and services) and your observability backends like Splunk Observability Cloud.</p><p>By centralizing telemetry traffic, the gateway enables advanced features such as data filtering, enrichment, transformation, and routing to one or more destinations. It helps reduce the burden on individual services by offloading telemetry processing and ensures consistent, standardized data across distributed systems.</p><p>This makes your observability pipeline easier to manage, scale, and analyze—especially in complex, multi-service environments.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Open or create your second terminal window and name it <strong>Gateway</strong>. Navigate to the first exercise directory <code>[WORKSHOP]/1-agent-gateway</code>
then check the contents of the <code>gateway.yaml</code> file.</p><p>This file outlines the core structure of the OpenTelemetry Collector as deployed in <strong>Gateway</strong> mode:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> cat ./gateway.yaml</span></span></code></pre></div><div class=tab-panel data-tab-group=45322f84e750e010ed73428975dbb307><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gatewayyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("45322f84e750e010ed73428975dbb307","gatewayyaml")'>
<span class=tab-nav-text>gateway.yaml</span></button></div><div class=tab-content-container><div data-tab-item=gatewayyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################         This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##         configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                       </span><span class=c># List of extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                   </span><span class=c># Health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14133</span><span class=w>       </span><span class=c># Custom port to avoid conflicts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                           </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                       </span><span class=c># HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span><span class=w>  </span><span class=c># Custom port to avoid conflicts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c># Required for token pass-through</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># List of exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enable detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces.out&#34;</span><span class=w>  </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/metrics</span><span class=p>:</span><span class=w>                   </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-metrics.out&#34;</span><span class=w> </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-logs.out&#34;</span><span class=w>    </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                       </span><span class=c># List of processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                 </span><span class=c># Limits memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s           </span><span class=w> </span><span class=c># Memory check interval</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Batches data before exporting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>                </span><span class=c># Groups data by token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>X-SF-Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>              </span><span class=c># Adds metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>upsert             </span><span class=w> </span><span class=c># Inserts or updates a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode  </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway&#34;</span><span class=w>            </span><span class=c># Key value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Connectors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#connectors:                      # leave this commented out; we will uncomment in an upcoming exercise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                          </span><span class=c># Service configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>none                </span><span class=w> </span><span class=c># Disable metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check]     </span><span class=w> </span><span class=c># Enabled extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                      </span><span class=c># Configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>                      </span><span class=c># Metrics pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>                         </span><span class=c># Logs pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/logs</span></span></span></code></pre></div></div></div></div></div></div></details><h3 id=understanding-the-gateway-configuration>Understanding the Gateway Configuration</h3><p>Let’s explore the <code>gateway.yaml</code> file that defines how the OpenTelemetry Collector is configured in <strong>Gateway</strong> mode during this workshop. This <strong>Gateway</strong> is responsible for receiving telemetry from the <strong>Agent</strong>, then processing and exporting it for inspection or forwarding.</p><ul><li><p><strong>OTLP Receiver (Custom Port)</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span></span></span></code></pre></div><p>The port <code>5318</code> matches the <code>otlphttp</code> exporter in the <strong>Agent</strong> configuration, ensuring that all telemetry data sent by the <strong>Agent</strong> is accepted by the <strong>Gateway</strong>.</p></li></ul><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>This separation of ports avoids conflicts and keeps responsibilities clear between agent and gateway roles.</p></div></details><ul><li><p><strong>File Exporters</strong></p><p>The <strong>Gateway</strong> uses three file exporters to output telemetry data to local files. These exporters are defined as:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./gateway-traces.out</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./gateway-metrics.out</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./gateway-logs.out</span></span></span></code></pre></div><p>Each exporter writes a specific signal type to its corresponding file:</p><ul><li><code>gateway-traces.out</code>: stores span (trace) data</li><li><code>gateway-metrics.out</code>: stores metric data</li><li><code>gateway-logs.out</code>: stores log data</li></ul><p>These files are created once the gateway is started and will be populated with real telemetry as the agent sends data. You can monitor these files in real time to observe the flow of telemetry through your pipeline.</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-send-metrics>1.2 Send Metrics</h1><p>Now, we can start the <strong>Gateway</strong> and the <strong>Agent</strong>, which will start sending <strong>metrics</strong>. Then we will send <strong>traces</strong> and generate <strong>logs</strong> to verify that all signals are properly routed through the <strong>Agent</strong> to the <strong>Gateway</strong>.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> window, run the following command to start the <strong>Gateway</strong>:</p><div class=tab-panel data-tab-group=d7884f8f96d4c4c1806b7ab33d64e3b5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d7884f8f96d4c4c1806b7ab33d64e3b5","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p>If everything is configured correctly, the first and last lines of the output should look like:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/06/09 09:22:11 settings.go:478: Set config to [gateway.yaml]
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>2025-06-09T09:22:11.944+0100    info    service@v0.126.0/service.go:289 Everything is ready. Begin running and processing data. {&#34;resource&#34;: {}}</span></span></code></pre></div><p>Once the <strong>Gateway</strong> is running, it will listen for incoming data on port <code>5318</code> and export the received data to the following files:</p><ul><li><code>gateway-traces.out</code></li><li><code>gateway-metrics.out</code></li><li><code>gateway-logs.out</code></li></ul><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> window start the agent with the agent configuration:</p><div class=tab-panel data-tab-group=545ae93f7b7f5d5382708a03d09138f6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("545ae93f7b7f5d5382708a03d09138f6","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Verify CPU Metrics</strong>:</p><ol><li>Check that when the <strong>Agent</strong> starts, it immediately starts sending <strong>CPU</strong> metrics.</li><li>Both the <strong>Agent</strong> and the <strong>Gateway</strong> will display this activity in their debug output. The output should resemble the following snippet:</li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>NumberDataPoints #37
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>    -&gt; cpu: Str(cpu0)
</span></span><span class=line><span class=cl>    -&gt; state: Str(system)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 9637.660000</span></span></code></pre></div><p>At this stage, the <strong>Agent</strong> continues to collect <strong>CPU</strong> metrics once per hour or upon each restart and sends them to the gateway. The <strong>Gateway</strong> processes these metrics and exports them to a file named <code>./gateway-metrics.out</code>. This file stores the exported metrics as part of the pipeline service.</p><p><strong>Verify Data arrived at Gateway</strong>: To confirm that CPU metrics, specifically for <code>cpu0</code>, have successfully reached the gateway, we’ll inspect the <code>gateway-metrics.out</code> file using the <code>jq</code> command.</p><p>The following command filters and extracts the <code>system.cpu.time</code> metric, focusing on <code>cpu0</code>. It displays the metric’s state (e.g., <code>user</code>, <code>system</code>, <code>idle</code>, <code>interrupt</code>) along with the corresponding values.</p><p>Run the command below in the <strong>Tests terminal</strong> to check the <code>system.cpu.time</code> metric:</p><div class=tab-panel data-tab-group=44d372f2a9cfcf8360fc9ec6a3f7b44c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-cpu-metrics class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("44d372f2a9cfcf8360fc9ec6a3f7b44c","check-cpu-metrics")'>
<span class=tab-nav-text>Check CPU Metrics</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("44d372f2a9cfcf8360fc9ec6a3f7b44c","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=check-cpu-metrics class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[] | select(.name == &#34;system.cpu.time&#34;) | .sum.dataPoints[] | select(.attributes[0].value.stringValue == &#34;cpu0&#34;) | {cpu: .attributes[0].value.stringValue, state: .attributes[1].value.stringValue, value: .asDouble}&#39;</span> gateway-metrics.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>123407.02</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>64866.6</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>216427.87</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=13-send-traces-from-the-agent-to-the-gateway>1.3 Send traces from the Agent to the Gateway</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Send a Test Trace</strong>:</p><ol><li>Validate <strong>Agent</strong> and <strong>Gateway</strong> are still running.</li><li>In the <strong>Spans terminal</strong> window, run the following command to send 5 spans and validate the output of the <strong>Agent</strong> and <strong>Gateway</strong> debug logs:</li></ol><div class=tab-panel data-tab-group=f4f8f07ef9982337018e39e232908b21><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f4f8f07ef9982337018e39e232908b21","start-the-load-generator")'>
<span class=tab-nav-text>Start the Load Generator</span>
</button>
<button data-tab-item=agentgateway-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f4f8f07ef9982337018e39e232908b21","agentgateway-debug-output")'>
<span class=tab-nav-text>Agent/Gateway Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=start-the-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div><div data-tab-item=agentgateway-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-03-06T11:49:00.456Z        info    Traces  {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-03-06T11:49:00.456Z        info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(cinema-service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(production)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope cinema.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; fintest.scope.attribute: Str(Starwars, LOTR)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 97fb4e5b13400b5689e3306da7cff077
</span></span><span class=line><span class=cl>    Parent ID      :
</span></span><span class=line><span class=cl>    ID             : 413358465e5b4f15
</span></span><span class=line><span class=cl>    Name           : /movie-validator
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2025-03-06 11:49:00.431915 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2025-03-06 11:49:01.431915 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Ok
</span></span><span class=line><span class=cl>    Status message : Success
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>     -&gt; payment.amount: Double(87.01)
</span></span><span class=line><span class=cl>        {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;}</span></span></code></pre></div></div></div></div></div><p><strong>Verify the Gateway has handled the spans</strong>: Once the gateway processes incoming spans, it writes the trace data to a file named <code>gateway-traces.out</code>. To confirm that the spans have been successfully handled, you can inspect this file.</p><p>In your <strong>Tests terminal</strong>, use the <code>jq</code> command to extract and display key details about each span, such as its <code>spanId</code> and its position in the file. Also, we can extract the attributes that the <strong>Hostmetrics Receiver</strong> added to the spans.</p><div class=tab-panel data-tab-group=6af76f84605f84b650375428bbd39996><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=inspect-the-gateway-trace-file class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6af76f84605f84b650375428bbd39996","inspect-the-gateway-trace-file")'>
<span class=tab-nav-text>Inspect the Gateway Trace File</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6af76f84605f84b650375428bbd39996","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=inspect-the-gateway-trace-file class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[] as $resource | $resource.scopeSpans[].spans[] | &#34;Span \(input_line_number) found with spanId \(.spanId), hostname \($resource.resource.attributes[] | select(.key == &#34;host.name&#34;) | .value.stringValue), os \($resource.resource.attributes[] | select(.key == &#34;os.type&#34;) | .value.stringValue)&#34;&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with spanId d71fe6316276f97d, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with spanId e8d19489232f8c2a, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with spanId 9dfaf22857a6bd05, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with spanId c7f544a4b5fef5fc, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with spanId 30bb49261315969d, hostname workshop-instance, os linux&#34;</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=14-send-logs>1.4 Send Logs</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the log load generator:</strong> In the <strong>Logs terminal</strong> window, run the following command to start the <code>loadgen</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs</span></span></code></pre></div><p>A continuous stream of log data from the <code>quotes.log</code> will be in the <strong>Agent</strong> and <strong>Gateway</strong> debug logs:</p><div class=tab-panel data-tab-group=c5ec15da7541517cbd9dd387c70fd4c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agentgateway-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c5ec15da7541517cbd9dd387c70fd4c0","agentgateway-debug-output")'>
<span class=tab-nav-text>Agent/Gateway Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=agentgateway-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-03-06 15:18:32 [ERROR] - There is some good in this world, and it&#39;s worth fighting for. LOTR)
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>LogRecord #1</span></span></code></pre></div></div></div></div></div><p><strong>Stop the <code>loadgen</code></strong>: In the <strong>Logs terminal</strong> window, stop the <code>loadgen</code> using <code>Ctrl-C</code>.</p><p><strong>Verify the gateway</strong>: Check if the <strong>Gateway</strong> has written a <code>./gateway-logs.out</code> file.</p><p>At this point, your directory structure will appear as follows:</p><div class=tab-panel data-tab-group=791f75c1c3e4259196e92db1c2346008><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("791f75c1c3e4259196e92db1c2346008","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.out
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>├── gateway-logs.out     # Output from the logs pipeline
</span></span><span class=line><span class=cl>├── gateway-metrics.out  # Output from the metrics pipeline
</span></span><span class=line><span class=cl>├── gateway-traces.out   # Output from the traces pipeline
</span></span><span class=line><span class=cl>├── gateway.yaml
</span></span><span class=line><span class=cl>└── quotes.log           # File containing Random log lines</span></span></code></pre></div></div></div></div></div><p><strong>Examine a log line</strong>: In <code>gateway-logs.out</code> compare a log line with the snippet below. Verify that the log entry includes the same attributes as we have seen in metrics and traces data previously:</p><div class=tab-panel data-tab-group=8f454ed2fa9322d18ab3920555f74abe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-logsout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8f454ed2fa9322d18ab3920555f74abe","cat-gateway-logsout")'>
<span class=tab-nav-text>cat /gateway-logs.out</span>
</button>
<button data-tab-item=cat-gateway-logsout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8f454ed2fa9322d18ab3920555f74abe","cat-gateway-logsout--jq")'>
<span class=tab-nav-text>cat ./gateway-logs.out | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-logsout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;workshop-instance&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;linux&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;gateway&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741274312475540000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - All we have to decide is what to do with the time that is given us. LOTR&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>},{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741274312475560000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - Your focus determines your reality. SW&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-logsout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;workshop-instance&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;linux&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;gateway&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741274312475540000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - All we have to decide is what to do with the time that is given us. LOTR&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741274312475560000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - Your focus determines your reality. SW&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>You may also have noticed that every log line contains empty placeholders for <code>"traceId":""</code> and <code>"spanId":""</code>.
The FileLog receiver will populate these fields only if they are not already present in the log line.
For example, if the log line is generated by an application instrumented with an OpenTelemetry instrumentation library, these fields will already be included and will not be overwritten.</p><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.95/js/clipboard/clipboard.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/perfect-scrollbar/perfect-scrollbar.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/theme.min.js?1751388568 defer></script></body></html>