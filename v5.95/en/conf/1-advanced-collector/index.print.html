<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 7.6.1+81b6d3c32c77aeecc29c4700d2123bd2fb3401c2"><meta name=description content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.95/en/conf/1-advanced-collector/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta itemprop=dateModified content="2025-06-09T16:10:16+01:00"><meta itemprop=wordCount content="246"><title>Advanced Collector Configuration :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.95/en/conf/1-advanced-collector/index.html rel=canonical type=text/html title="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.95/images/favicon.ico?1751388568 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.95/css/auto-complete/auto-complete.min.css?1751388568 rel=stylesheet><script src=/observability-workshop/v5.95/js/auto-complete/auto-complete.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/search-lunr.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/search.min.js?1751388568 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v5.95/searchindex.en.js?1751388568"</script><script src=/observability-workshop/v5.95/js/lunr/lunr.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/lunr/lunr.stemmer.support.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/lunr/lunr.multi.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/lunr/lunr.en.min.js?1751388568 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v5.95/fonts/fontawesome/css/fontawesome-all.min.css?1751388568 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.95/fonts/fontawesome/css/fontawesome-all.min.css?1751388568 rel=stylesheet></noscript><link href=/observability-workshop/v5.95/css/perfect-scrollbar/perfect-scrollbar.min.css?1751388568 rel=stylesheet><link href=/observability-workshop/v5.95/css/theme.min.css?1751388568 rel=stylesheet><link href=/observability-workshop/v5.95/css/format-print.min.css?1751388568 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/conf/1-advanced-collector/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.95",window.relearn.version_js_url="/observability-workshop/v5.95/versionindex.en.js?1751388568",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"Z8JjZ8iNiF4jSfNHvJIRJg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"Z8JjZ8iNiF4jSfNHvJIRJg"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v5.95/en/conf/1-advanced-collector/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#workshop-overview>Workshop Overview</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.95/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Splunk .conf25 Workshops</span><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Advanced Collector Configuration</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.95/en/conf/1-advanced-collector/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.95/en/index.html title="Splunk Observability Workshops (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.95/en/conf/1-advanced-collector/prerequisites/index.html title="Pre-requisites (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable conf" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=advanced-collector-configuration>Advanced Collector Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>75 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Authors
</span><span class=badge-content>Robert Castley,
Charity Anderson,
Pieter Hagen
&
Geoff Higginbottom</span></span><p>The goal of this workshop is to help you gain confidence in creating and modifying OpenTelemetry Collector configuration files. You’ll start with a minimal <code>agent.yaml</code> and <code>gateway.yaml</code> file and progressively build them out to handle several advanced, real-world scenarios.</p><p>A key focus of this workshop is learning how to configure the OpenTelemetry Collector to store telemetry data locally, rather than sending it to a third-party vendor backend. This approach not only simplifies debugging and troubleshooting but is also ideal for testing and development environments where you want to avoid sending data to production systems.</p><p>To make the most of this workshop, you should have:</p><ul><li>A basic understanding of the OpenTelemetry Collector and its configuration file structure.</li><li>Proficiency in editing YAML files.</li></ul><p>Everything in this workshop is designed to run locally, ensuring a hands-on and accessible learning experience. Let’s dive in and start building!</p><h3 id=workshop-overview>Workshop Overview</h3><p>During this workshop, we will cover the following topics:</p><ul><li><strong>Setting up the agent and gateway locally</strong>: Test that metrics, traces, and logs go via the agent to the gateway.</li><li><strong>Enhancing agent resilience</strong>: Basic configurations for fault tolerance.</li><li><strong>Configuring processors</strong>:<ul><li>Filter out noise by dropping specific spans (e.g., health checks).</li><li>Remove unnecessary tags, and handle sensitive data.</li><li>Transform data using OTTL (OpenTelemetry Transformation Language) in the pipeline before exporting.</li></ul></li><li><strong>Configuring Connectors</strong>:<ul><li>Route data to different endpoints based on the values received.</li></ul></li></ul><p>By the end of this workshop, you&rsquo;ll be familiar with configuring the OpenTelemetry Collector for a variety of real-world use cases.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Advanced Collector Configuration</h1><article class=default><header class=headline></header><h1 id=pre-requisites>Pre-requisites</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;<h3 id=prerequisites>Prerequisites</h3><ul><li>Proficiency in editing YAML files using <code>vi</code>, <code>vim</code>, <code>nano</code>, or your preferred text editor.</li><li>Supported Environments:<ul><li>A provided Splunk Workshop Instance (preferred). Outbound access to port <code>2222</code> is required for <code>ssh</code> access.</li><li>Apple Mac (Apple Silicon). Installation of <code>jq</code> is required - <a href=https://jqlang.org/download/ rel=external target=_blank><strong>https://jqlang.org/download/</strong></a></li></ul></li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Create a workshop directory</strong>: In your environment create a new directory (e.g. <code>advanced-otel-workshop</code>). We will refer to this directory as <code>[WORKSHOP]</code> for the remainder of the workshop.</p><p><strong>Download workshop binaries</strong>: Change into your <code>[WORKSHOP]</code> directory and download the OpenTelemetry Collector, Load Generator binaries and setup script:</p><div class=tab-panel data-tab-group=5ac7b6cc38a27278a0b1ccf4d2e642fa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=splunk-workshop-instance class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5ac7b6cc38a27278a0b1ccf4d2e642fa","splunk-workshop-instance")'>
<span class=tab-nav-text>Splunk Workshop Instance</span>
</button>
<button data-tab-item=apple-silicon class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5ac7b6cc38a27278a0b1ccf4d2e642fa","apple-silicon")'>
<span class=tab-nav-text>Apple Silicon</span></button></div><div class=tab-content-container><div data-tab-item=splunk-workshop-instance class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-collector/releases/download/v0.126.0/otelcol_linux_amd64 -o otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/loadgen/build/loadgen-linux-amd64 -o loadgen <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/setup-workshop.sh -o setup-workshop.sh</span></span></code></pre></div></div></div><div data-tab-item=apple-silicon class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-collector/releases/download/v0.126.0/otelcol_darwin_arm64 -o otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/loadgen/build/loadgen-darwin-arm64 -o loadgen <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/setup-workshop.sh -o setup-workshop.sh</span></span></code></pre></div></div></div></div></div><p>Run the <code>setup-workshop.sh</code> script which will configure the correct permissions and also create the initial configurations for the <strong>Agent</strong> and the <strong>Gateway</strong>:</p><div class=tab-panel data-tab-group=c4146cde2513b26f7dfd9f3b4da047d8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=setup-workshop class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c4146cde2513b26f7dfd9f3b4da047d8","setup-workshop")'>
<span class=tab-nav-text>Setup Workshop</span>
</button>
<button data-tab-item=verify-setup class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c4146cde2513b26f7dfd9f3b4da047d8","verify-setup")'>
<span class=tab-nav-text>Verify Setup</span></button></div><div class=tab-content-container><div data-tab-item=setup-workshop class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sh setup-workshop.sh</span></span></code></pre></div></div></div><div data-tab-item=verify-setup class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>███████╗██████╗ ██╗     ██╗   ██╗███╗   ██╗██╗  ██╗    ██╗
</span></span><span class=line><span class=cl>██╔════╝██╔══██╗██║     ██║   ██║████╗  ██║██║ ██╔╝    ╚██╗
</span></span><span class=line><span class=cl>███████╗██████╔╝██║     ██║   ██║██╔██╗ ██║█████╔╝      ╚██╗
</span></span><span class=line><span class=cl>╚════██║██╔═══╝ ██║     ██║   ██║██║╚██╗██║██╔═██╗      ██╔╝
</span></span><span class=line><span class=cl>███████║██║     ███████╗╚██████╔╝██║ ╚████║██║  ██╗    ██╔╝
</span></span><span class=line><span class=cl>╚══════╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═╝    ╚═╝
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Welcome to the Splunk Advanced OpenTelemetry Workshop!
</span></span><span class=line><span class=cl>======================================================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>macOS detected. Removing quarantine attributes...
</span></span><span class=line><span class=cl>otelcol version v0.126.0
</span></span><span class=line><span class=cl>Usage: loadgen [OPTIONS]
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>  -base       Send base traces (enabled by default)
</span></span><span class=line><span class=cl>  -health     Send health traces
</span></span><span class=line><span class=cl>  -security   Send security traces
</span></span><span class=line><span class=cl>  -logs       Enable logging of random quotes to quotes.log
</span></span><span class=line><span class=cl>  -json       Output logs in JSON format (only applicable with -logs)
</span></span><span class=line><span class=cl>  -count      Number of traces or logs to send (default: infinite)
</span></span><span class=line><span class=cl>  -h, --help  Display this help message
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example:
</span></span><span class=line><span class=cl>  loadgen -health -security -count 10   Send 10 health and security traces
</span></span><span class=line><span class=cl>  loadgen -logs -json -count 5          Write 5 random quotes in JSON format to quotes.log
</span></span><span class=line><span class=cl>Creating workshop directories...
</span></span><span class=line><span class=cl>✓ Created subdirectories:
</span></span><span class=line><span class=cl>  ├── 1-agent-gateway
</span></span><span class=line><span class=cl>  ├── 2-building-resilience
</span></span><span class=line><span class=cl>  ├── 3-dropping-spans
</span></span><span class=line><span class=cl>  ├── 4-sensitive-data
</span></span><span class=line><span class=cl>  ├── 5-transform-data
</span></span><span class=line><span class=cl>  └── 6-routing-data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating configuration files for 1-agent-gateway...
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector agent configuration file: 1-agent-gateway/agent.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 1-agent-gateway/agent.yaml
</span></span><span class=line><span class=cl>✓ File size:     4355 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector gateway configuration file: 1-agent-gateway/gateway.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 1-agent-gateway/gateway.yaml
</span></span><span class=line><span class=cl>✓ File size:     3376 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>✓ Completed configuration files for 1-agent-gateway
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating configuration files for 2-building-resilience...
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector agent configuration file: 2-building-resilience/agent.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 2-building-resilience/agent.yaml
</span></span><span class=line><span class=cl>✓ File size:     4355 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector gateway configuration file: 2-building-resilience/gateway.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 2-building-resilience/gateway.yaml
</span></span><span class=line><span class=cl>✓ File size:     3376 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>✓ Completed configuration files for 2-building-resilience
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Workshop environment setup complete!
</span></span><span class=line><span class=cl>Configuration files created in the following directories:
</span></span><span class=line><span class=cl>  1-agent-gateway/
</span></span><span class=line><span class=cl>    ├── agent.yaml
</span></span><span class=line><span class=cl>    └── gateway.yaml
</span></span><span class=line><span class=cl>  2-building-resilience/
</span></span><span class=line><span class=cl>    ├── agent.yaml
</span></span><span class=line><span class=cl>    └── gateway.yaml</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=598f1ee0856ddc6a57f8ae991d18a0a6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=initial-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("598f1ee0856ddc6a57f8ae991d18a0a6","initial-directory-structure")'>
<span class=tab-nav-text>Initial Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=initial-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>├── otelcol                # OpenTelemetry Collector binary
</span></span><span class=line><span class=cl>├── loadgen                # Load Generator binary
</span></span><span class=line><span class=cl>├── 1-agent-gateway        # Directories for exercises
</span></span><span class=line><span class=cl>├── 2-building-resilience
</span></span><span class=line><span class=cl>├── 3-dropping-spans
</span></span><span class=line><span class=cl>├── 4-sensitive-data
</span></span><span class=line><span class=cl>├── 5-transform-data
</span></span><span class=line><span class=cl>└── 6-routing-data</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=1-agentgateway-configuration>1. Agent/Gateway Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Welcome! In this section, we’ll begin with a fully functional OpenTelemetry setup that includes both an <strong>Agent</strong> and a <strong>Gateway</strong>.</p><p>We’ll start by quickly reviewing their configuration files to get familiar with the overall structure and to highlight key sections that control the telemetry pipeline.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Throughout the workshop, you’ll work with multiple terminal windows. To keep things organized, give each terminal a unique name or color. This will help you easily recognize and switch between them during the exercises.</p><p>We will refer to these terminals as: <strong>Agent</strong>, <strong>Gateway</strong>, <strong>Spans</strong>, <strong>Logs</strong>, and <strong>Tests</strong>.</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ol><li><p>Create your first terminal window and name it <strong>Agent</strong>. Navigate to the directory for the first exercise <code>[WORKSHOP]/1-agent-gateway</code> and verify that the required files have been generated:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> 1-agent-gateway
</span></span><span class=line><span class=cl>ls -l</span></span></code></pre></div></li><li><p>You should see the following files in the directory. If not, re-run the <code>setup-workshop.sh</code> script as described in the <strong>Pre-requisites</strong> section:</p><div class=tab-panel data-tab-group=9135e7dd07687df77ba1384ea4e9c200><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9135e7dd07687df77ba1384ea4e9c200","directory-structure")'>
<span class=tab-nav-text>Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></li><li><p>Check the contents of the <strong>agent.yaml</strong> file. This file outlines the core structure of the OpenTelemetry Collector as deployed in <strong>Agent</strong> mode:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    cat ./agent.yaml</span></span></code></pre></div></li><li><p>You will see a pre-configured setup tailored for this workshop:</p><div class=tab-panel data-tab-group=cd80f4a8b1690ca60305cbe79c8e1d1d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agentyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cd80f4a8b1690ca60305cbe79c8e1d1d","agentyaml")'>
<span class=tab-nav-text>agent.yaml</span></button></div><div class=tab-content-container><div data-tab-item=agentyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################            This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##            configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################            used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                            </span><span class=c># Array of Extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                        </span><span class=c># Configures the health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>            </span><span class=c># Endpoint to collect health check data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>                             </span><span class=c># Array of Receivers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                         </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s        </span><span class=w> </span><span class=c># Scrape metrics every hour</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>                          </span><span class=c># Array of hostmetric scrapers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                             </span><span class=c># Scraper for cpu metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                                </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>                         </span><span class=c># list of Protocols used </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                            </span><span class=c># This wil enable the HTTP Protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>       </span><span class=c># Endpoint for incoming telemetry data </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                             </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                               </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed               </span><span class=w> </span><span class=c># Enabled detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                            </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>  </span><span class=c># Gateway OTLP endpoint  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file</span><span class=p>:</span><span class=w>                                </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./agent.out&#34;</span><span class=w>                </span><span class=c># Save path (OTLP JSON)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                      </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                            </span><span class=c># Array of Processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                      </span><span class=c># Limits memory usage by Collectors pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s                </span><span class=w> </span><span class=c># Interval to check memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                     </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection</span><span class=p>:</span><span class=w>                   </span><span class=c># Processor Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]               </span><span class=w> </span><span class=c># Detect system resource information</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>override</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                     </span><span class=c># Overwrites existing attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>                   </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>                        </span><span class=c># Array of attributes and modifications</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert                  </span><span class=w> </span><span class=c># Action is to insert a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode       </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=w>                   </span><span class=c># Key value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################            This section controls what</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###            configurations will be used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################            by this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                               </span><span class=c># Services configured for this Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>                          </span><span class=c># Enabled extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                           </span><span class=c># Array of configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hostmetrics                   </span><span class=w> </span><span class=c># Hostmetric reciever (cpu only)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes                </span><span class=w> </span><span class=c># Filelog Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></div></div></div></li></ol></div></details><h3 id=understanding-the-agent-configuration>Understanding the Agent configuration</h3><p>Let’s review the key components of the <code>agent.yaml</code> file used in this workshop. We’ve made some important additions to support metrics, traces, and logs.</p><h4 id=receivers>Receivers</h4><p>The <code>receivers</code> section defines how the <strong>Agent</strong> ingests telemetry data. In this setup, three types of receivers have been configured:</p><ul><li><p><strong>Host Metrics Receiver</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                         </span><span class=c># Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s        </span><span class=w> </span><span class=c># Collection Interval (1hr)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                             </span><span class=c># CPU Scraper</span></span></span></code></pre></div><p>Collects CPU usage from the local system every hour. We’ll use this to generate example metric data.</p></li><li><p><strong>OTLP Receiver (HTTP protocol)</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otlp</span><span class=p>:</span><span class=w>                                </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>                            </span><span class=c># Configure HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>       </span><span class=c># Endpoint to bind to</span></span></span></code></pre></div><p>Enables the agent to receive metrics, traces, and logs over HTTP on port <code>4318</code>. This is used to send data to the collector in future exercises.</p></li><li><p><strong>FileLog Receiver</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span></span></span></code></pre></div><p>Enables the agent to tail a local log file (<code>quotes.log</code>) and convert it to structured log events, enriched with metadata such as <code>source</code> and <code>sourceType</code>.</p></li></ul><h4 id=exporters>Exporters</h4><ul><li><p>The <code>exporters</code> section controls where the collected telemetry data is sent:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>                             </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                               </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed               </span><span class=w> </span><span class=c># Enabled detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                            </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>  </span><span class=c># Gateway OTLP endpoint  </span></span></span></code></pre></div><p>The <code>debug</code> exporter sends data to the console for visibility and debugging during the workshop while the <code>otlphttp</code> exporter forwards all telemetry to the local <strong>Gateway</strong> instance.</p></li></ul><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>This dual-export strategy ensures you can see the raw data locally while also sending it downstream for further processing and export.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1. Agent/Gateway Configuration</h1><article class=default><header class=headline></header><h1 id=11-gateway-configuration>1.1 Gateway Configuration</h1><p>The <strong>OpenTelemetry Gateway</strong> serves as a central hub for receiving, processing, and exporting telemetry data. It sits between your telemetry sources (such as applications and services) and your observability backends like Splunk Observability Cloud.</p><p>By centralizing telemetry traffic, the gateway enables advanced features such as data filtering, enrichment, transformation, and routing to one or more destinations. It helps reduce the burden on individual services by offloading telemetry processing and ensures consistent, standardized data across distributed systems.</p><p>This makes your observability pipeline easier to manage, scale, and analyze—especially in complex, multi-service environments.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Open or create your second terminal window and name it <strong>Gateway</strong>. Navigate to the first exercise directory <code>[WORKSHOP]/1-agent-gateway</code>
then check the contents of the <code>gateway.yaml</code> file.</p><p>This file outlines the core structure of the OpenTelemetry Collector as deployed in <strong>Gateway</strong> mode:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> cat ./gateway.yaml</span></span></code></pre></div><div class=tab-panel data-tab-group=45322f84e750e010ed73428975dbb307><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gatewayyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("45322f84e750e010ed73428975dbb307","gatewayyaml")'>
<span class=tab-nav-text>gateway.yaml</span></button></div><div class=tab-content-container><div data-tab-item=gatewayyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################         This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##         configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                       </span><span class=c># List of extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                   </span><span class=c># Health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14133</span><span class=w>       </span><span class=c># Custom port to avoid conflicts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                           </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                       </span><span class=c># HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span><span class=w>  </span><span class=c># Custom port to avoid conflicts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c># Required for token pass-through</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># List of exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enable detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces.out&#34;</span><span class=w>  </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/metrics</span><span class=p>:</span><span class=w>                   </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-metrics.out&#34;</span><span class=w> </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-logs.out&#34;</span><span class=w>    </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                       </span><span class=c># List of processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                 </span><span class=c># Limits memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s           </span><span class=w> </span><span class=c># Memory check interval</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Batches data before exporting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>                </span><span class=c># Groups data by token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>X-SF-Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>              </span><span class=c># Adds metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>upsert             </span><span class=w> </span><span class=c># Inserts or updates a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode  </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway&#34;</span><span class=w>            </span><span class=c># Key value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Connectors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#connectors:                      # leave this commented out; we will uncomment in an upcoming exercise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                          </span><span class=c># Service configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>none                </span><span class=w> </span><span class=c># Disable metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check]     </span><span class=w> </span><span class=c># Enabled extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                      </span><span class=c># Configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>                      </span><span class=c># Metrics pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>                         </span><span class=c># Logs pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/logs</span></span></span></code></pre></div></div></div></div></div></div></details><h3 id=understanding-the-gateway-configuration>Understanding the Gateway Configuration</h3><p>Let’s explore the <code>gateway.yaml</code> file that defines how the OpenTelemetry Collector is configured in <strong>Gateway</strong> mode during this workshop. This <strong>Gateway</strong> is responsible for receiving telemetry from the <strong>Agent</strong>, then processing and exporting it for inspection or forwarding.</p><ul><li><p><strong>OTLP Receiver (Custom Port)</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span></span></span></code></pre></div><p>The port <code>5318</code> matches the <code>otlphttp</code> exporter in the <strong>Agent</strong> configuration, ensuring that all telemetry data sent by the <strong>Agent</strong> is accepted by the <strong>Gateway</strong>.</p></li></ul><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>This separation of ports avoids conflicts and keeps responsibilities clear between agent and gateway roles.</p></div></details><ul><li><p><strong>File Exporters</strong></p><p>The <strong>Gateway</strong> uses three file exporters to output telemetry data to local files. These exporters are defined as:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./gateway-traces.out</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./gateway-metrics.out</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./gateway-logs.out</span></span></span></code></pre></div><p>Each exporter writes a specific signal type to its corresponding file:</p><ul><li><code>gateway-traces.out</code>: stores span (trace) data</li><li><code>gateway-metrics.out</code>: stores metric data</li><li><code>gateway-logs.out</code>: stores log data</li></ul><p>These files are created once the gateway is started and will be populated with real telemetry as the agent sends data. You can monitor these files in real time to observe the flow of telemetry through your pipeline.</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-send-metrics>1.2 Send Metrics</h1><p>Now, we can start the <strong>Gateway</strong> and the <strong>Agent</strong>, which will start sending <strong>metrics</strong>. Then we will send <strong>traces</strong> and generate <strong>logs</strong> to verify that all signals are properly routed through the <strong>Agent</strong> to the <strong>Gateway</strong>.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> window, run the following command to start the <strong>Gateway</strong>:</p><div class=tab-panel data-tab-group=d7884f8f96d4c4c1806b7ab33d64e3b5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d7884f8f96d4c4c1806b7ab33d64e3b5","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p>If everything is configured correctly, the first and last lines of the output should look like:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/06/09 09:22:11 settings.go:478: Set config to [gateway.yaml]
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>2025-06-09T09:22:11.944+0100    info    service@v0.126.0/service.go:289 Everything is ready. Begin running and processing data. {&#34;resource&#34;: {}}</span></span></code></pre></div><p>Once the <strong>Gateway</strong> is running, it will listen for incoming data on port <code>5318</code> and export the received data to the following files:</p><ul><li><code>gateway-traces.out</code></li><li><code>gateway-metrics.out</code></li><li><code>gateway-logs.out</code></li></ul><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> window start the agent with the agent configuration:</p><div class=tab-panel data-tab-group=545ae93f7b7f5d5382708a03d09138f6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("545ae93f7b7f5d5382708a03d09138f6","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Verify CPU Metrics</strong>:</p><ol><li>Check that when the <strong>Agent</strong> starts, it immediately starts sending <strong>CPU</strong> metrics.</li><li>Both the <strong>Agent</strong> and the <strong>Gateway</strong> will display this activity in their debug output. The output should resemble the following snippet:</li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>NumberDataPoints #37
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>    -&gt; cpu: Str(cpu0)
</span></span><span class=line><span class=cl>    -&gt; state: Str(system)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 9637.660000</span></span></code></pre></div><p>At this stage, the <strong>Agent</strong> continues to collect <strong>CPU</strong> metrics once per hour or upon each restart and sends them to the gateway. The <strong>Gateway</strong> processes these metrics and exports them to a file named <code>./gateway-metrics.out</code>. This file stores the exported metrics as part of the pipeline service.</p><p><strong>Verify Data arrived at Gateway</strong>: To confirm that CPU metrics, specifically for <code>cpu0</code>, have successfully reached the gateway, we’ll inspect the <code>gateway-metrics.out</code> file using the <code>jq</code> command.</p><p>The following command filters and extracts the <code>system.cpu.time</code> metric, focusing on <code>cpu0</code>. It displays the metric’s state (e.g., <code>user</code>, <code>system</code>, <code>idle</code>, <code>interrupt</code>) along with the corresponding values.</p><p>Run the command below in the <strong>Tests terminal</strong> to check the <code>system.cpu.time</code> metric:</p><div class=tab-panel data-tab-group=44d372f2a9cfcf8360fc9ec6a3f7b44c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-cpu-metrics class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("44d372f2a9cfcf8360fc9ec6a3f7b44c","check-cpu-metrics")'>
<span class=tab-nav-text>Check CPU Metrics</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("44d372f2a9cfcf8360fc9ec6a3f7b44c","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=check-cpu-metrics class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[] | select(.name == &#34;system.cpu.time&#34;) | .sum.dataPoints[] | select(.attributes[0].value.stringValue == &#34;cpu0&#34;) | {cpu: .attributes[0].value.stringValue, state: .attributes[1].value.stringValue, value: .asDouble}&#39;</span> gateway-metrics.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>123407.02</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>64866.6</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>216427.87</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=13-send-traces-from-the-agent-to-the-gateway>1.3 Send traces from the Agent to the Gateway</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Send a Test Trace</strong>:</p><ol><li>Validate <strong>Agent</strong> and <strong>Gateway</strong> are still running.</li><li>In the <strong>Spans terminal</strong> window, run the following command to send 5 spans and validate the output of the <strong>Agent</strong> and <strong>Gateway</strong> debug logs:</li></ol><div class=tab-panel data-tab-group=f4f8f07ef9982337018e39e232908b21><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f4f8f07ef9982337018e39e232908b21","start-the-load-generator")'>
<span class=tab-nav-text>Start the Load Generator</span>
</button>
<button data-tab-item=agentgateway-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f4f8f07ef9982337018e39e232908b21","agentgateway-debug-output")'>
<span class=tab-nav-text>Agent/Gateway Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=start-the-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div><div data-tab-item=agentgateway-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-03-06T11:49:00.456Z        info    Traces  {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-03-06T11:49:00.456Z        info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(cinema-service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(production)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope cinema.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; fintest.scope.attribute: Str(Starwars, LOTR)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 97fb4e5b13400b5689e3306da7cff077
</span></span><span class=line><span class=cl>    Parent ID      :
</span></span><span class=line><span class=cl>    ID             : 413358465e5b4f15
</span></span><span class=line><span class=cl>    Name           : /movie-validator
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2025-03-06 11:49:00.431915 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2025-03-06 11:49:01.431915 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Ok
</span></span><span class=line><span class=cl>    Status message : Success
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>     -&gt; payment.amount: Double(87.01)
</span></span><span class=line><span class=cl>        {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;}</span></span></code></pre></div></div></div></div></div><p><strong>Verify the Gateway has handled the spans</strong>: Once the gateway processes incoming spans, it writes the trace data to a file named <code>gateway-traces.out</code>. To confirm that the spans have been successfully handled, you can inspect this file.</p><p>In your <strong>Tests terminal</strong>, use the <code>jq</code> command to extract and display key details about each span, such as its <code>spanId</code> and its position in the file. Also, we can extract the attributes that the <strong>Hostmetrics Receiver</strong> added to the spans.</p><div class=tab-panel data-tab-group=6af76f84605f84b650375428bbd39996><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=inspect-the-gateway-trace-file class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6af76f84605f84b650375428bbd39996","inspect-the-gateway-trace-file")'>
<span class=tab-nav-text>Inspect the Gateway Trace File</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6af76f84605f84b650375428bbd39996","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=inspect-the-gateway-trace-file class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[] as $resource | $resource.scopeSpans[].spans[] | &#34;Span \(input_line_number) found with spanId \(.spanId), hostname \($resource.resource.attributes[] | select(.key == &#34;host.name&#34;) | .value.stringValue), os \($resource.resource.attributes[] | select(.key == &#34;os.type&#34;) | .value.stringValue)&#34;&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with spanId d71fe6316276f97d, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with spanId e8d19489232f8c2a, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with spanId 9dfaf22857a6bd05, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with spanId c7f544a4b5fef5fc, hostname workshop-instance, os linux&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with spanId 30bb49261315969d, hostname workshop-instance, os linux&#34;</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=14-send-logs>1.4 Send Logs</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the log load generator:</strong> In the <strong>Logs terminal</strong> window, run the following command to start the <code>loadgen</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs</span></span></code></pre></div><p>A continuous stream of log data from the <code>quotes.log</code> will be in the <strong>Agent</strong> and <strong>Gateway</strong> debug logs:</p><div class=tab-panel data-tab-group=c5ec15da7541517cbd9dd387c70fd4c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agentgateway-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c5ec15da7541517cbd9dd387c70fd4c0","agentgateway-debug-output")'>
<span class=tab-nav-text>Agent/Gateway Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=agentgateway-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-03-06 15:18:32 [ERROR] - There is some good in this world, and it&#39;s worth fighting for. LOTR)
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>LogRecord #1</span></span></code></pre></div></div></div></div></div><p><strong>Stop the <code>loadgen</code></strong>: In the <strong>Logs terminal</strong> window, stop the <code>loadgen</code> using <code>Ctrl-C</code>.</p><p><strong>Verify the gateway</strong>: Check if the <strong>Gateway</strong> has written a <code>./gateway-logs.out</code> file.</p><p>At this point, your directory structure will appear as follows:</p><div class=tab-panel data-tab-group=791f75c1c3e4259196e92db1c2346008><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("791f75c1c3e4259196e92db1c2346008","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.out
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>├── gateway-logs.out     # Output from the logs pipeline
</span></span><span class=line><span class=cl>├── gateway-metrics.out  # Output from the metrics pipeline
</span></span><span class=line><span class=cl>├── gateway-traces.out   # Output from the traces pipeline
</span></span><span class=line><span class=cl>├── gateway.yaml
</span></span><span class=line><span class=cl>└── quotes.log           # File containing Random log lines</span></span></code></pre></div></div></div></div></div><p><strong>Examine a log line</strong>: In <code>gateway-logs.out</code> compare a log line with the snippet below. Verify that the log entry includes the same attributes as we have seen in metrics and traces data previously:</p><div class=tab-panel data-tab-group=8f454ed2fa9322d18ab3920555f74abe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-logsout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8f454ed2fa9322d18ab3920555f74abe","cat-gateway-logsout")'>
<span class=tab-nav-text>cat /gateway-logs.out</span>
</button>
<button data-tab-item=cat-gateway-logsout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8f454ed2fa9322d18ab3920555f74abe","cat-gateway-logsout--jq")'>
<span class=tab-nav-text>cat ./gateway-logs.out | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-logsout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;workshop-instance&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;linux&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;gateway&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741274312475540000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - All we have to decide is what to do with the time that is given us. LOTR&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>},{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741274312475560000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - Your focus determines your reality. SW&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-logsout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;workshop-instance&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;linux&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;gateway&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741274312475540000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - All we have to decide is what to do with the time that is given us. LOTR&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741274312475560000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - Your focus determines your reality. SW&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>You may also have noticed that every log line contains empty placeholders for <code>"traceId":""</code> and <code>"spanId":""</code>.
The FileLog receiver will populate these fields only if they are not already present in the log line.
For example, if the log line is generated by an application instrumented with an OpenTelemetry instrumentation library, these fields will already be included and will not be overwritten.</p><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=2-building-in-resilience>2. Building In Resilience</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The OpenTelemetry Collector’s <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/19bc7d6ee854c0c1b5c97d8d348e5b9d1199e8aa/extension/storage/filestorage/README.md rel=external target=_blank><strong>FileStorage Extension</strong></a> enhances the resilience of your telemetry pipeline by providing reliable check-pointing, managing retries, and handling temporary failures effectively.</p><p>With this extension enabled, the OpenTelemetry Collector can store intermediate states on disk, preventing data loss during network disruptions and allowing it to resume operations seamlessly.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>This solution will work for metrics as long as the connection downtime is brief—up to 15 minutes. If the downtime exceeds this, Splunk Observability Cloud will drop data due to datapoints being out of order.</p><p>For logs, there are plans to implement a more enterprise-ready solution in one of the upcoming Splunk OpenTelemetry Collector releases.</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/2-building-resilience</code> directory.</strong></p></div></details><p>Your directory structure will look like this:</p><div class=tab-panel data-tab-group=65ab714907c17e9888ddb193b6b7232d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("65ab714907c17e9888ddb193b6b7232d","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 2. Building Resilience</h1><article class=default><header class=headline></header><h1 id=21-file-storage-configuration>2.1 File Storage Configuration</h1><p>In this exercise, we will update the <code>extensions:</code> section of the <code>agent.yaml</code> file. This section is part of the OpenTelemetry configuration YAML and defines optional components that enhance or modify the OpenTelemetry Collector’s behavior.</p><p>While these components do not process telemetry data directly, they provide valuable capabilities and services to improve the Collector’s functionality.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update the <code>agent.yaml</code></strong>: In the <strong>Agent terminal</strong> window, add the <code>file_storage</code> extension and name it <code>checkpoint</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage/checkpoint</span><span class=p>:</span><span class=w>             </span><span class=c># Extension Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir&#34;</span><span class=w>      </span><span class=c># Define directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>create_directory</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>             </span><span class=c># Create directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>1s                       </span><span class=w> </span><span class=c># Timeout for file operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>                        </span><span class=c># Compaction settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                   </span><span class=c># Start compaction at Collector startup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Define compaction directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir/tmp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_transaction_size</span><span class=p>:</span><span class=w> </span><span class=m>65536</span><span class=w>      </span><span class=c># Max. size limit before compaction occurs</span></span></span></code></pre></div><p><strong>Add <code>file_storage</code> to existing <code>otlphttp</code> exporter</strong>: Modify the <code>otlphttp:</code> exporter to configure retry and queuing mechanisms, ensuring data is retained and resent if failures occur:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>retry_on_failure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                    </span><span class=c># Enable retry on failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sending_queue</span><span class=p>:</span><span class=w>                     </span><span class=c># </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                    </span><span class=c># Enable sending queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>num_consumers</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>                </span><span class=c># No. of consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>queue_size</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>                </span><span class=c># Max. queue size</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>file_storage/checkpoint</span><span class=w> </span><span class=c># File storage extension</span></span></span></code></pre></div><p><strong>Update the <code>services</code> section</strong>: Add the <code>file_storage/checkpoint</code> extension to the existing <code>extensions:</code> section. This will cause the extension to be enabled:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage/checkpoint           </span><span class=w> </span><span class=c># Enabled extensions for this collector</span></span></span></code></pre></div><p><strong>Update the <code>metrics</code> pipeline</strong>: For this exercise we are going to comment out the <code>hostmetrics</code> receiver from the Metric pipeline to reduce debug and log noise:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># - hostmetrics                  # Hostmetrics Receiver</span></span></span></code></pre></div></div></details><p>Validate the <strong>Agent</strong> configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>metrics:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(otlphttp&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-metrics
    subgraph &#34; &#34;
      subgraph subID1[**Metrics**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP1
      PRO4 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=22-setup-environment-for-resilience-testing>2.2 Setup environment for Resilience Testing</h1><p>Next, we will configure our environment to be ready for testing the <strong>File Storage</strong> configuration.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=88706b82ec5a91ae53a1c3e91a2d2aa0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("88706b82ec5a91ae53a1c3e91a2d2aa0","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=5c1798abd27f74f84927efcb8a2e97a6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5c1798abd27f74f84927efcb8a2e97a6","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send five test spans</strong>: In the <strong>Spans terminal</strong> window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=bbe2ca819ae931fc81c729de3163a3e1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bbe2ca819ae931fc81c729de3163a3e1","start-load-generator")'>
<span class=tab-nav-text>Start Load Generator</span></button></div><div class=tab-content-container><div data-tab-item=start-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug logs, and the <strong>Gateway</strong> should create a <code>./gateway-traces.out</code> file.</p></div></details><p>If everything functions correctly, we can proceed with testing system resilience.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=23-simulate-failure>2.3 Simulate Failure</h1><p>To assess the <strong>Agent&rsquo;s</strong> resilience, we&rsquo;ll simulate a temporary <strong>Gateway</strong> outage and observe how the <strong>Agent</strong> handles it:</p><p><strong>Summary</strong>:</p><ol><li><strong>Send Traces to the Agent</strong> – Generate traffic by sending traces to the <strong>Agent</strong>.</li><li><strong>Stop the Gateway</strong> – This will trigger the <strong>Agent</strong> to enter retry mode.</li><li><strong>Restart the Gateway</strong> – The <strong>Agent</strong> will recover traces from its persistent queue and forward them successfully. Without the persistent queue, these traces would have been lost permanently.</li></ol><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Simulate a network failure</strong>: In the <strong>Gateway terminal</strong> stop the <strong>Gateway</strong> with <code>Ctrl-C</code> and wait until the gateway console shows that it has stopped:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T13:24:32.785+0100  info  service@v0.120.0/service.go:309  Shutdown complete.</span></span></code></pre></div><p><strong>Send traces</strong>: In the <strong>Spans terminal</strong> window send five more traces using the <code>loadgen</code>.</p><p>Notice that the agent’s retry mechanism is activated as it continuously attempts to resend the data. In the agent’s console output, you will see repeated messages similar to the following:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:22:47.020+0100  info  internal/retry_sender.go:126  Exporting failed. Will retry the request after interval.  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;otlphttp&#34;, &#34;error&#34;: &#34;failed to make an HTTP request: Post \&#34;http://localhost:5318/v1/traces\&#34;: dial tcp 127.0.0.1:5318: connect: connection refused&#34;, &#34;interval&#34;: &#34;9.471474933s&#34;}</span></span></code></pre></div><p><strong>Stop the Agent</strong>: In the <strong>Agent terminal</strong> window, use <code>Ctrl-C</code> to stop the agent. Wait until the agent’s console confirms it has stopped:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:40:28.702+0100  info  extensions/extensions.go:66  Stopping extensions...
</span></span><span class=line><span class=cl>2025-01-28T14:40:28.702+0100  info  service@v0.120.0/service.go:309  Shutdown complete.</span></span></code></pre></div></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Stopping the agent will halt its retry attempts and prevent any future retry activity.</p><p>If the agent runs for too long without successfully delivering data, it may begin dropping traces, depending on the retry configuration, to conserve memory. By stopping the agent, any metrics, traces, or logs currently stored in memory are lost before being dropped, ensuring they remain available for recovery.</p><p>This step is essential for clearly observing the recovery process when the agent is restarted.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=24-recovery>2.4 Recovery</h1><p>In this exercise, we’ll test how the <strong>OpenTelemetry Collector</strong> recovers from a network outage by restarting the <strong>Gateway</strong> collector. When the <strong>Gateway</strong> becomes available again, the <strong>Agent</strong> will resume sending data from its last check-pointed state, ensuring no data loss.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Restart the Gateway</strong>: In the <strong>Gateway terminal</strong> window run:</p><div class=tab-panel data-tab-group=f014ffbb6feca9c58adead9f240bc459><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f014ffbb6feca9c58adead9f240bc459","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Restart the Agent</strong>: In the <strong>Agent terminal</strong> window run:</p><div class=tab-panel data-tab-group=caa14a82a3ec52c6b2c3e33421b9dc29><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("caa14a82a3ec52c6b2c3e33421b9dc29","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>After the <strong>Agent</strong> is up and running, the <strong>File_Storage</strong> extension will detect buffered data in the checkpoint folder.<br>It will start to dequeue the stored spans from the last checkpoint folder, ensuring no data is lost.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify the Agent Debug output</strong><br>Note that the Agent Debug Screen does <strong>NOT</strong> change and still shows the following line indicating no new data is being exported.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-07T13:40:12.195+0100    info    service@v0.120.0/service.go:253 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Watch the Gateway Debug output</strong><br>You should see from the <strong>Gateway</strong> debug screen, it has started receiving the previously missed traces without requiring any additional action on your part.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>2025-02-07T12:44:32.651+0100    info    service@v0.120.0/service.go:253 Everything is ready. Begin running and processing data.
</span></span><span class=line><span class=cl>2025-02-07T12:47:46.721+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 4, &#34;spans&#34;: 4}
</span></span><span class=line><span class=cl>2025-02-07T12:47:46.721+0100    info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:</span></span></code></pre></div><p><strong>Check the <code>gateway-traces.out</code> file</strong><br>Using <code>jq</code>, count the number of traces in the recreated <code>gateway-traces.out</code>. It should match the number you send when the <strong>Gateway</strong> was down.</p><div class=tab-panel data-tab-group=4e029b0a2ee37c8a8bcb125e01aced39><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-gateway-traces-out-file class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4e029b0a2ee37c8a8bcb125e01aced39","check-gateway-traces-out-file")'>
<span class=tab-nav-text>Check Gateway Traces Out File</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("4e029b0a2ee37c8a8bcb125e01aced39","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=check-gateway-traces-out-file class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans | length | &#34;\(.) resourceSpans found&#34;&#39;</span> gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;5 resourceSpans found&#34;</span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details><h3 id=conclusion>Conclusion</h3><p>This exercise demonstrated how to enhance the resilience of the OpenTelemetry Collector by configuring the <code>file_storage</code> extension, enabling retry mechanisms for the <code>otlp</code> exporter, and using a file-backed queue for temporary data storage.</p><p>By implementing file-based check-pointing and queue persistence, you ensure the telemetry pipeline can gracefully recover from temporary interruptions, making it a more robust and reliable for production environments.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=3-dropping-spans>3. Dropping Spans</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we will explore how to use the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/filterprocessor/README.md rel=external target=_blank><strong>Filter Processor</strong></a> to selectively drop spans based on certain conditions.</p><p>Specifically, we will drop traces based on the span name, which is commonly used to filter out unwanted spans such as health checks or internal communication traces. In this case, we will be filtering out spans whose name is <code>"/_healthz"</code>, typically associated with health check requests and usually are quite &ldquo;<strong>noisy</strong>&rdquo;.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/3-dropping-spans</code> directory.</strong></p></div></details><p>Copy <code>*.yaml</code> from the <code>2-building-resilience</code> directory into <code>3-dropping-spans</code>. Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=84ef720ac665b61f7f179a79fcce1d7e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("84ef720ac665b61f7f179a79fcce1d7e","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the <strong>filter processor</strong> and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 3. Dropping Spans</h1><article class=default><header class=headline></header><h1 id=31-configuration>3.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Gateway terminal</strong> window and open the <code>gateway.yaml</code> file. Update the <code>processors</code> section with the following configuration:</p><ol><li><p><strong>Add a <code>filter</code> processor</strong>:<br>Configure the gateway to exclude spans with the name <code>/_healthz</code>. The <code>error_mode: ignore</code> directive ensures that any errors encountered during filtering are ignored, allowing the pipeline to continue running smoothly. The <code>traces</code> section defines the filtering rules, specifically targeting spans named <code>/_healthz</code> for exclusion.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filter/health</span><span class=p>:</span><span class=w>                       </span><span class=c># Defines a filter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                </span><span class=w> </span><span class=c># Ignore errors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>traces</span><span class=p>:</span><span class=w>                            </span><span class=c># Filtering rules for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>span</span><span class=p>:</span><span class=w>                            </span><span class=c># Exclude spans named &#34;/_healthz&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span></span></span></code></pre></div></li><li><p><strong>Add the <code>filter</code> processor to the <code>traces</code> pipeline</strong>:<br>Include the <code>filter/health</code> processor in the <code>traces</code> pipeline. For optimal performance, place the filter as early as possible—right after the <code>memory_limiter</code> and before the <code>batch</code> processor. Here’s how the configuration should look:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filter/health            </span><span class=w> </span><span class=c># Filters data based on rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file/traces</span></span></span></code></pre></div></li></ol><p>This setup ensures that health check-related spans (<code>/_healthz</code>) are filtered out early in the pipeline, reducing unnecessary noise in your telemetry data.</p></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(filter&lt;br&gt;fa:fa-microchip&lt;br&gt;health):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;file&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO4
      PRO4 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=32-test-filter-processor>3.2 Test Filter Processor</h1><p>To test your configuration, you&rsquo;ll need to generate some trace data that includes a span named <code>"/_healthz"</code>.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <strong>Gateway</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config ./gateway.yaml</span></span></code></pre></div><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <strong>Agent</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config ./agent.yaml</span></span></code></pre></div><p><strong>Start the Loadgen</strong>: In the <strong>Spans terminal</strong> window run the <code>loadgen</code> with the flag to also send <code>healthz</code> spans along with base spans:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -health -count <span class=m>5</span></span></span></code></pre></div><p><strong>Verify <code>agent.out</code></strong>: Using <code>jq</code> confirm the name of the spans received by the <strong>Agent</strong>:</p><div class=tab-panel data-tab-group=088b4bfd137b6e5b8b6e1834cb996764><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-spans-in-agentout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("088b4bfd137b6e5b8b6e1834cb996764","check-spans-in-agentout")'>
<span class=tab-nav-text>Check spans in agent.out</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("088b4bfd137b6e5b8b6e1834cb996764","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=check-spans-in-agentout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with name \(.name)&#34;&#39;</span> ./agent.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 6 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 7 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 8 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 9 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 10 found with name /_healthz&#34;</span></span></code></pre></div></div></div></div></div><p><strong>Check the Gateway Debug output</strong>: Using <code>jq</code> confirm the name of the spans received by the <strong>Gateway</strong>:</p><div class=tab-panel data-tab-group=bf2962977640267f020088d20a4ad812><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-spans-in-gateway-tracesout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bf2962977640267f020088d20a4ad812","check-spans-in-gateway-tracesout")'>
<span class=tab-nav-text>Check spans in gateway-traces.out</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("bf2962977640267f020088d20a4ad812","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=check-spans-in-gateway-tracesout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=tab-panel data-tab-group=87d2c52a38d51caca545a475144e97c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-spans-in-gateway-tracesout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("87d2c52a38d51caca545a475144e97c9","check-spans-in-gateway-tracesout")'>
<span class=tab-nav-text>Check spans in gateway-traces.out</span></button></div><div class=tab-content-container><div data-tab-item=check-spans-in-gateway-tracesout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with name \(.name)&#34;&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div></div></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The <code>gateway-metrics.out</code> file will not contain any spans named <code>/_healthz</code>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with name /movie-validator&#34;</span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>When using the <code>Filter</code> processor, make sure you understand the look of your incoming data and test the configuration thoroughly. In general, use <strong>as specific a configuration as possible</strong> to lower the risk of the wrong data being dropped.</p><p>You can further extend this configuration to filter out spans based on different attributes, tags, or other criteria, making the OpenTelemetry Collector more customizable and efficient for your observability needs.</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=4-redacting-sensitive-data>4. Redacting Sensitive Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, you&rsquo;ll learn how to configure the OpenTelemetry Collector to remove specific tags and redact sensitive data from telemetry spans. This is crucial for protecting sensitive information such as credit card numbers, personal data, or other security-related details that must be anonymized before being processed or exported.</p><p>We&rsquo;ll walk through configuring key processors in the OpenTelemetry Collector, including:</p><ul><li><strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/attributesprocessor/README.md rel=external target=_blank>Attributes Processor</a></strong>: Modifies or removes specific span attributes.</li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/redactionprocessor/README.md rel=external target=_blank><strong>Redaction Processor</strong></a>: Ensures sensitive data is sanitized before being stored or transmitted.</li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/4-sensitive-data</code> directory.</strong></p></div></details><p>Copy <code>*.yaml</code> from the <code>3-dropping-spans</code> directory into <code>4-sensitive-data</code>. Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=161b78151695467ee5e016dfcfad6bad><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("161b78151695467ee5e016dfcfad6bad","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 4. Sensitive Data</h1><article class=default><header class=headline></header><h1 id=41-configuration>4.1 Configuration</h1><p>In this step, we&rsquo;ll modify <code>agent.yaml</code> to include the <code>attributes</code> and <code>redaction</code> processors. These processors will help ensure that sensitive data within span attributes is properly handled before being logged or exported.</p><p>Previously, you may have noticed that some span attributes displayed in the console contained personal and sensitive data. We&rsquo;ll now configure the necessary processors to filter out and redact this information effectively.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Agent terminal</strong> window and open the <code>agent.yaml</code> file in your editor. We’ll add two processors to enhance the security and privacy of your telemetry data: the Attributes Processor and the Redaction Processor.</p><p><strong>Add an <code>attributes</code> Processor</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/attributesprocessor rel=external target=_blank><strong>Attributes Processor</strong></a> allows you to modify span attributes (tags) by updating, deleting, or hashing their values. This is particularly useful for obfuscating sensitive information before it is exported.</p><p>In this step, we’ll:</p><ol><li><strong>Update</strong> the <code>user.phone_number</code> attribute to a static value <code>("UNKNOWN NUMBER")</code>.</li><li><strong>Hash</strong> the <code>user.email</code> attribute to ensure the original email is not exposed.</li><li><strong>Delete</strong> the <code>user.password</code> attribute to remove it entirely from the span.</li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>                           </span><span class=c># Actions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.phone_number        </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update                </span><span class=w> </span><span class=c># Update action</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UNKNOWN NUMBER&#34;</span><span class=w>        </span><span class=c># New value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.email               </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>hash                  </span><span class=w> </span><span class=c># Hash the email value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.password            </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete                </span><span class=w> </span><span class=c># Delete the password</span></span></span></code></pre></div><p><strong>Add a <code>redaction</code> Processor</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/redactionprocessor rel=external target=_blank><strong>Redaction Processor</strong></a> detects and redacts sensitive data in span attributes based on predefined patterns, such as credit card numbers or other personally identifiable information (PII).</p><p>In this step:</p><ul><li><p>We set <code>allow_all_keys: true</code> to ensure all attributes are processed (if set to <code>false</code>, only explicitly allowed keys are retained).</p></li><li><p>We define <code>blocked_values</code> with regular expressions to detect and redact <strong>Visa</strong> and <strong>MasterCard</strong> credit card numbers.</p></li><li><p>The <code>summary: debug</code> option logs detailed information about the redaction process for debugging purposes.</p></li></ul><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>redaction/redact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>               </span><span class=c># If false, only allowed keys will be retained</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>                    </span><span class=c># List of regex patterns to block</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b4[0-9]{3}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>       </span><span class=c># Visa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b5[1-5][0-9]{2}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>  </span><span class=c># MasterCard</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug                    </span><span class=w> </span><span class=c># Show debug details about redaction</span></span></span></code></pre></div><p><strong>Update the <code>traces</code> Pipeline</strong>: Integrate both processors into the <code>traces</code> pipeline. Make sure that you comment out the redaction processor at first (we will enable it later in a separate exercise):</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>Leave the <code>redaction/redact</code> processor commented out in this exercise. We will enable it in an upcoming exercise.</p></div></details><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- redaction/redact               # Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRML(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRRD(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRRS(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRBA(batch&lt;br&gt;fa:fa-microchip):::processor
      PRUP(attributes&lt;br&gt;fa:fa-microchip&lt;br&gt;update):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP3(file&lt;br&gt;fa:fa-upload):::exporter

    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRML
      PRML --&gt; PRUP
      PRUP --&gt; PRRD
      PRRD --&gt; PRRS
      PRRS --&gt; PRBA
      PRBA --&gt; EXP2
      PRBA --&gt; EXP3
      PRBA --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=42-test-attribute-processor>4.2 Test Attribute Processor</h1><p>In this exercise, we will <strong>delete</strong> the <code>user.account_password</code>, <strong>update</strong> the <code>user.phone_number</code> <strong>attribute</strong> and <strong>hash</strong> the <code>user.email</code> in the span data before it is exported by the <strong>Agent</strong>.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <strong>Gateway</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <strong>Agent</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p><strong>Start the Load Generator</strong>: In the <strong>Spans terminal</strong> window start the <code>loadgen</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> debug output, confirm that <code>user.account_password</code> has been removed, and both <code>user.phone_number</code> & <code>user.email</code> have been updated.</p><div class=tab-panel data-tab-group=c849388da105e109afa272afc5622ce4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c849388da105e109afa272afc5622ce4","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c849388da105e109afa272afc5622ce4","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>   -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(51.71)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(5555 5555 5555 4444)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>    -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>    -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>    -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>    -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>    -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>    -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>    -&gt; payment.amount: Double(95.22)</span></span></code></pre></div></div></div></div></div><p><strong>Check file output</strong>: Using <code>jq</code> validate that <code>user.account_password</code> has been removed, and <code>user.phone_number</code> & <code>user.email</code> have been updated in <code>gateway-taces.out</code>:</p><div class=tab-panel data-tab-group=6dd1d745ade983647d2416de20f47d76><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=validate-attribute-changes class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6dd1d745ade983647d2416de20f47d76","validate-attribute-changes")'>
<span class=tab-nav-text>Validate attribute changes</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6dd1d745ade983647d2416de20f47d76","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=validate-attribute-changes class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[].attributes[] | select(.key == &#34;user.password&#34; or .key == &#34;user.phone_number&#34; or .key == &#34;user.email&#34;) | {key: .key, value: .value.stringValue}&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Notice that the <code>user.account_password</code> has been removed, and the <code>user.phone_number</code> & <code>user.email</code> have been updated:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;UNKNOWN NUMBER&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=43-test-redaction-processor>4.3 Test Redaction Processor</h1><p>The <code>redaction</code> processor gives precise control over which attributes and values are <strong>permitted</strong> or <strong>removed</strong> from telemetry data.</p><p>In this exercise, we will <strong>redact</strong> the <code>user.visa</code> & <code>user.mastercard</code> <strong>values</strong> in the span data before it is exported by the <strong>Agent</strong>.<details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Prepare the terminals</strong>: Delete the <code>*.out</code> files and clear the screen.</p><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <strong>Gateway</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div><p><strong>Enable the <code>redaction/redact</code> processor</strong>: In the <strong>Agent terminal</strong> window, edit <code>agent.yaml</code> and remove the <code>#</code> we inserted in the previous exercise.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redaction/redact              </span><span class=w> </span><span class=c># Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <strong>Agent</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p><strong>Start the Load Generator</strong>: In the <strong>Spans terminal</strong> window start the <code>loadgen</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> confirm the values for <code>user.visa</code> & <code>user.mastercard</code> have been updated. Notice <code>user.amex</code> attribute value was NOT redacted because a matching regex pattern was not added to <code>blocked_values</code></p><div class=tab-panel data-tab-group=dc0480d52435340dfe213ab5477a78f2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("dc0480d52435340dfe213ab5477a78f2","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("dc0480d52435340dfe213ab5477a78f2","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>   -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(69.71)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(****)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(****)
</span></span><span class=line><span class=cl>   -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>   -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>    -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>    -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>    -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>    -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>    -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>    -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>    -&gt; payment.amount: Double(65.54)</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>By including <code>summary:debug</code> in the redaction processor, the debug output will include summary information about which matching key values were redacted, along with the count of values that were masked.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>     -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>     -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></details><p><strong>Check file output</strong>: Using <code>jq</code> verify that <code>user.visa</code> & <code>user.mastercard</code> have been updated in the <code>gateway-traces.out</code>.</p><div class=tab-panel data-tab-group=82adc0af2e37d6b8ac1c4eca6a07b388><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=validate-attribute-changes class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("82adc0af2e37d6b8ac1c4eca6a07b388","validate-attribute-changes")'>
<span class=tab-nav-text>Validate attribute changes</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("82adc0af2e37d6b8ac1c4eca6a07b388","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=validate-attribute-changes class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[].attributes[] | select(.key == &#34;user.visa&#34; or .key == &#34;user.mastercard&#34; or .key == &#34;user.amex&#34;) | {key: .key, value: .value.stringValue}&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Notice that <code>user.amex</code> has not been redacted because a matching regex pattern was not added to <code>blocked_values</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>These are just a few examples of how <code>attributes</code> and <code>redaction</code> processors can be configured to protect sensitive data.</p></div></details></p><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=5-transform-data>5. Transform Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/transformprocessor/README.md rel=external target=_blank><strong>Transform Processor</strong></a> lets you modify telemetry data—logs, metrics, and traces—as it flows through the pipeline. Using the <strong>OpenTelemetry Transformation Language (OTTL)</strong>, you can filter, enrich, and transform data on the fly without touching your application code.</p><p>In this exercise we’ll update <code>agent.yaml</code> to include a <strong>Transform Processor</strong> that will:</p><ul><li><strong>Filter</strong> log resource attributes.</li><li><strong>Parse</strong> JSON structured log data into attributes.</li><li><strong>Set</strong> log severity levels based on the log message body.</li></ul><p>You may have noticed that in previous logs, fields like <code>SeverityText</code> and <code>SeverityNumber</code> were undefined. This is typical of the <code>filelog</code> receiver. However, the severity is embedded within the log body:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText: 
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div><p>Logs often contain structured data encoded as JSON within the log body. Extracting these fields into attributes allows for better indexing, filtering, and querying. Instead of manually parsing JSON in downstream systems, OTTL enables automatic transformation at the telemetry pipeline level.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/5-transform-data</code> directory.</strong></p></div></details><p>Copy <code>*.yaml</code> from the <code>4-sensitve-data</code> directory into <code>5-transform-data</code>. Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=a6cdb573b140fe89b0abc031b903af8c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a6cdb573b140fe89b0abc031b903af8c","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 5. Transform Data</h1><article class=default><header class=headline></header><h1 id=51-configuration>5.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add a <code>transform</code> processor</strong>: Switch to your <strong>Agent terminal</strong> window and edit the <code>agent.yaml</code> and add the following <code>transform</code> processor:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>transform/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>log_statements</span><span class=p>:</span><span class=w>                    </span><span class=c># Log Processing Statements</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>resource             </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                    </span><span class=c># List of attribute keys to keep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>keep_keys(attributes, [&#34;com.splunk.sourcetype&#34;, &#34;host.name&#34;, &#34;otelcol.service.mode&#34;])</span></span></span></code></pre></div><p>By using the <code>-context: resource</code> key we are targeting the <code>resourceLog</code> attributes of logs.</p><p>This configuration ensures that only the relevant resource attributes (<code>com.splunk.sourcetype</code>, <code>host.name</code>, <code>otelcol.service.mode</code>) are retained, improving log efficiency and reducing unnecessary metadata.</p><p><strong>Adding a Context Block for Log Severity Mapping</strong>: To properly set the <code>severity_text</code> and <code>severity_number</code> fields of a log record, we add a <code>log</code> context block within <code>log_statements</code>. This configuration extracts the <code>level</code> value from the log body, maps it to <code>severity_text</code>, and assigns the corresponding <code>severity_number</code> based on the log level:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>log                  </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                    </span><span class=c># Transform Statements Array</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(cache, ParseJSON(body)) where IsMatch(body, &#34;^\\{&#34;) </span><span class=w> </span><span class=c># Parse JSON log body into a cache object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>flatten(cache, &#34;&#34;)                                       </span><span class=w> </span><span class=c># Flatten nested JSON structure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>merge_maps(attributes, cache, &#34;upsert&#34;)                  </span><span class=w> </span><span class=c># Merge cache into attributes, updating existing keys</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_text, attributes[&#34;level&#34;])                  </span><span class=w> </span><span class=c># Set severity_text from the &#34;level&#34; attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 1) where severity_text == &#34;TRACE&#34;   </span><span class=w> </span><span class=c># Map severity_text to severity_number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 5) where severity_text == &#34;DEBUG&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 9) where severity_text == &#34;INFO&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 13) where severity_text == &#34;WARN&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 17) where severity_text == &#34;ERROR&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 21) where severity_text == &#34;FATAL&#34;</span></span></span></code></pre></div><p>The <code>merge_maps</code> function is used to combine two maps (dictionaries) into one. In this case, it merges the <code>cache</code> object (containing parsed JSON data from the log body) into the <code>attributes</code> map.</p><ul><li><strong>Parameters</strong>:<ul><li><code>attributes</code>: The target map where the data will be merged.</li><li><code>cache</code>: The source map containing the parsed JSON data.</li><li><code>"upsert"</code>: This mode ensures that if a key already exists in the <code>attributes</code> map, its value will be updated with the value from <code>cache</code>. If the key does not exist, it will be inserted.</li></ul></li></ul><p>This step is crucial because it ensures that all relevant fields from the log body (e.g., <code>level</code>, <code>message</code>, etc.) are added to the <code>attributes</code> map, making them available for further processing or exporting.</p><p><strong>Summary of Key Transformations</strong>:</p><ul><li><strong>Parse JSON</strong>: Extracts structured data from the log body.</li><li><strong>Flatten JSON</strong>: Converts nested JSON objects into a flat structure.</li><li><strong>Merge Attributes</strong>: Integrates extracted data into log attributes.</li><li><strong>Map Severity Text</strong>: Assigns severity_text from the log’s level attribute.</li><li><strong>Assign Severity Numbers</strong>: Converts severity levels into standardized numerical values.</li></ul><p>You should have a <strong>single</strong> <code>transform</code> processor containing two context blocks: one whose context is for <code>resource</code> and one whose context is for <code>log</code>.</p><p>This configuration ensures that log severity is correctly extracted, standardized, and structured for efficient processing.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>This method of mapping all JSON fields to top-level attributes should only be used for <strong>testing and debugging OTTL</strong>. It will result in high cardinality in a production scenario.</p></div></details><p><strong>Update the <code>logs</code> pipeline</strong>: Add the <code>transform/logs:</code> processor into the <code>logs:</code> pipeline:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs                </span><span class=w> </span><span class=c># Transform logs processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <a href=https://otelbin.io/ rel=external target=_blank><strong>https://otelbin.io</strong></a>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(transform&lt;br&gt;fa:fa-microchip&lt;br&gt;logs):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; PRO5
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=52-setup-environment>5.2 Setup Environment</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> run:</p><div class=tab-panel data-tab-group=a321ca90d162bb562d0028455368e7e1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a321ca90d162bb562d0028455368e7e1","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> run:</p><div class=tab-panel data-tab-group=759315c075f0bfc209febffab408072a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("759315c075f0bfc209febffab408072a","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Load Generator</strong>: Open the <strong>Logs terminal</strong> window and run the <code>loadgen</code>.</p><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>To ensure the logs are structured in JSON format, include the <code>-json</code> flag when starting the script.</p></div></details><div class=tab-panel data-tab-group=0cf7cd5d702ae4702d9b00eb71dcb55f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0cf7cd5d702ae4702d9b00eb71dcb55f","log-generator")'>
<span class=tab-nav-text>Log Generator</span></button></div><div class=tab-content-container><div data-tab-item=log-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs -json -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p>The <code>loadgen</code> will write 5 log lines to <code>./quotes.log</code> in JSON format.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=53-test-transform-processor>5.3 Test Transform Processor</h1><p>This test verifies that the <code>com.splunk/source</code> and <code>os.type</code> metadata have been <strong>removed</strong> from the log resource attributes before being exported by the <strong>Agent</strong>. Additionally, the test ensures that:</p><ol><li>The log body is parsed to extract severity information.<ul><li><code>SeverityText</code> and <code>SeverityNumber</code> are set on the <code>LogRecord</code>.</li></ul></li><li>JSON fields from the log body are promoted to log <code>attributes</code>.</li></ol><p>This ensures proper metadata filtering, severity mapping, and structured log enrichment before export.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> confirm that <code>com.splunk/source</code> and <code>os.type</code> have been removed:</p><div class=tab-panel data-tab-group=b300f96b3ff992c6dcfdedb5296c55c2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b300f96b3ff992c6dcfdedb5296c55c2","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b300f96b3ff992c6dcfdedb5296c55c2","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.source: Str(./quotes.log)
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>   -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div></div></div><p>For both the <strong>Agent</strong> and <strong>Gateway</strong> confirm that <code>SeverityText</code> and <code>SeverityNumber</code> in the <code>LogRecord</code> is now defined with the severity <code>level</code> from the log body. Confirm that the JSON fields from the body can be accessed as top-level log <code>Attributes</code>:</p><div class=tab-panel data-tab-group=7f95db98e5f52a7a5a39ae757083c0c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7f95db98e5f52a7a5a39ae757083c0c9","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("7f95db98e5f52a7a5a39ae757083c0c9","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText: WARN
</span></span><span class=line><span class=cl>SeverityNumber: Warn(13)
</span></span><span class=line><span class=cl>Body: Str({&#34;level&#34;:&#34;WARN&#34;,&#34;message&#34;:&#34;Your focus determines your reality.&#34;,&#34;movie&#34;:&#34;SW&#34;,&#34;timestamp&#34;:&#34;2025-03-07 11:17:26&#34;})
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>     -&gt; level: Str(WARN)
</span></span><span class=line><span class=cl>     -&gt; message: Str(Your focus determines your reality.)
</span></span><span class=line><span class=cl>     -&gt; movie: Str(SW)
</span></span><span class=line><span class=cl>     -&gt; timestamp: Str(2025-03-07 11:17:26)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str({&#34;level&#34;:&#34;WARN&#34;,&#34;message&#34;:&#34;Your focus determines your reality.&#34;,&#34;movie&#34;:&#34;SW&#34;,&#34;timestamp&#34;:&#34;2025-03-07 11:17:26&#34;})
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div></div></div></div></div><p><strong>Check file output</strong>: In the new <code>gateway-logs.out</code> file verify the data has been transformed:</p><div class=tab-panel data-tab-group=b2a4b38ecb161482713a815b895608cf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=jq-query class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b2a4b38ecb161482713a815b895608cf","jq-query")'>
<span class=tab-nav-text>jq Query</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b2a4b38ecb161482713a815b895608cf","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=jq-query class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;[.resourceLogs[].scopeLogs[].logRecords[] | {severityText, severityNumber, body: .body.stringValue}]&#39;</span> gateway-logs.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;DEBUG\&#34;,\&#34;message\&#34;:\&#34;All we have to decide is what to do with the time that is given us.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>13</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;WARN\&#34;,\&#34;message\&#34;:\&#34;The Force will be with you. Always.\&#34;,\&#34;movie\&#34;:\&#34;SW\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;ERROR\&#34;,\&#34;message\&#34;:\&#34;One does not simply walk into Mordor.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;DEBUG\&#34;,\&#34;message\&#34;:\&#34;Do or do not, there is no try.\&#34;,\&#34;movie\&#34;:\&#34;SW\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;ERROR\&#34;,\&#34;message\&#34;:\&#34;There is some good in this world, and it&#39;s worth fighting for.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=6-routing-data>6. Routing Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external target=_blank><strong>Routing Connector</strong></a> in OpenTelemetry is a powerful feature that allows you to direct data (<code>traces</code>, <code>metrics</code>, or <code>logs</code>) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.</p><p>For example, you might want to send <em>production</em> data to one exporter while directing <em>test</em> or <em>development</em> data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/6-routing-data</code> directory.</strong></p></div></details><p>Copy <code>*.yaml</code> from the <code>5-transform-data</code> directory into <code>6-routing-data</code>. Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=ae46f402f0664dd1bca440804d6a47ef><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ae46f402f0664dd1bca440804d6a47ef","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the routing connector and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 6. Routing Data</h1><article class=default><header class=headline></header><h1 id=61-configure-the-routing-connector>6.1 Configure the Routing Connector</h1><p>In this exercise, you will configure the <strong>Routing Connector</strong> in the <code>gateway.yaml</code> file. This setup enables the <strong>Gateway</strong> to route traces based on the <code>deployment.environment</code> attribute in the spans you send. By implementing this, you can process and handle traces differently depending on their attributes.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In OpenTelemetry configuration files, <code>connectors</code> have their own dedicated section, similar to receivers and processors.</p><p><strong>Add the <code>routing</code> connector</strong>:
In the <strong>Gateway terminal</strong> window, edit <code>gateway.yaml</code> and uncomment the <code>#connectors:</code> section. Then, add the following below the <code>connectors:</code> section:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/standard]</span><span class=w> </span><span class=c># Default pipeline if no rule matches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                  </span><span class=w> </span><span class=c># Ignore errors in routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                               </span><span class=c># Define routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Routes spans to a target pipeline if the resourceSpan attribute matches the rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security-applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/security]    </span><span class=w> </span><span class=c># Target pipeline </span></span></span></code></pre></div><p>The rules above apply to traces, but this approach also applies to <code>metrics</code> and <code>logs</code>, allowing them to be routed based on attributes in <code>resourceMetrics</code> or <code>resourceLogs</code>.</p><p><strong>Configure <code>file:</code> exporters</strong>: The <code>routing</code> connector requires separate targets for routing. In the <code>exporters:</code> section, add two file exporters, <code>file/traces/security</code> and <code>file/traces/standard</code>, to ensure data is directed correctly.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/standard</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for regular traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-standard.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                          </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/security</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for security traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-security.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                          </span><span class=c># Overwrite the file each time </span></span></span></code></pre></div></div></details><p>With the <code>routing</code> configuration complete, the next step is to configure the <code>pipelines</code> to apply these routing rules.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=62-configuring-the-pipelines>6.2 Configuring the Pipelines</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update the <code>traces</code> pipeline to use routing</strong>:</p><ol><li><p>To enable <code>routing</code>, update the original <code>traces:</code> pipeline by using <code>routing</code> as the only exporter. This ensures all span data is sent through the routing connector for evaluation.</p></li><li><p>Remove all processors and replace it with an empty array (<code>[]</code>). These are now defined in the <code>traces/standard</code> and <code>traces/security</code> pipelines.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                           </span><span class=c># Original traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                         </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                      </span><span class=w> </span><span class=c># Routing Connector</span></span></span></code></pre></div></li></ol><p><strong>Add both the <code>standard</code> and <code>security</code> traces pipelines</strong>:</p><ol><li><p><strong>Configure the Security pipeline</strong>: This pipeline will handle all spans that match the routing rule for <code>security</code>.
This uses <code>routing</code> as its receiver. Place it below the existing <code>traces:</code> pipeline:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/security</span><span class=p>:</span><span class=w>              </span><span class=c># New Security Traces/Spans Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                  </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/security     </span><span class=w> </span><span class=c># File Exporter for spans matching rule</span></span></span></code></pre></div></li><li><p><strong>Add the Standard pipeline</strong>: This pipeline processes all spans that do not match the routing rule.
This pipeline is also using <code>routing</code> as its receiver. Add this below the <code>traces/security</code> one:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/standard</span><span class=p>:</span><span class=w>              </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                  </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/standard     </span><span class=w> </span><span class=c># File exporter for unmatched spans</span></span></span></code></pre></div></li></ol></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      PRO6(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP4(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      ROUTE1(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
      ROUTE2(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
      ROUTE3(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
    %% Links
    subID1:::sub-traces
    subID2:::sub-traces
    subID3:::sub-traces
    subgraph &#34; &#34;
    direction LR
      subgraph subID1[**Traces**]
      REC1 --&gt; ROUTE1
      end
      subgraph subID2[**Traces/standard**]
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
      subgraph subID3[**Traces/security**]
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      PRO2 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=63-test-routing-connector>6.3 Test Routing Connector</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In this section, we will test the <code>routing</code> rule configured for the <strong>Gateway</strong>. The expected result is that the<code>span</code> generated by the <code>loadgen</code> will be sent to the <code>gateway-traces-security.out</code> file.</p><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <strong>Gateway</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config gateway.yaml</span></span></code></pre></div><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <strong>Agent</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config agent.yaml</span></span></code></pre></div><p><strong>Send a Regular Span</strong>: In the <strong>Spans terminal</strong> window send a regular span using the <code>loadgen</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> will display debug information. The gateway will also generate a new <code>gateway-traces-standard.out</code> file, as this is now the designated destination for regular spans.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you check <code>gateway-traces-standard.out</code>, it will contain the <code>span</code> sent by <code>loadgen</code>. You will also see an empty <code>gateway-traces-security.out</code> file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.</p></div></details><p><strong>Send a Security Span</strong>: In the <strong>Spans terminal</strong> window send a security span using the <code>security</code> flag:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -security -count <span class=m>1</span></span></span></code></pre></div><p>Again, both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug information, including the span you just sent. This time, the <strong>Gateway</strong> will write a line to the <code>gateway-traces-security.out</code> file, which is designated for spans where the <code>deployment.environment</code> resource attribute matches <code>"security-applications"</code>.
The <code>gateway-traces-standard.out</code> should be unchanged.</p><div class=tab-panel data-tab-group=0a310b7ee0d4e98b1c873fd32dc75827><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=validate-resource-attribute-matches class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0a310b7ee0d4e98b1c873fd32dc75827","validate-resource-attribute-matches")'>
<span class=tab-nav-text>Validate resource attribute matches</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("0a310b7ee0d4e98b1c873fd32dc75827","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=validate-resource-attribute-matches class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[] as $resource | $resource.scopeSpans[].spans[] | {spanId: .spanId, deploymentEnvironment: ($resource.resource.attributes[] | select(.key == &#34;deployment.environment&#34;) | .value.stringValue)}&#39;</span> gateway-traces-security.out</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;cb799e92e26d5782&#34;</span><span class=p>,</span><span class=nt>&#34;deploymentEnvironment&#34;</span><span class=p>:</span><span class=s2>&#34;security-applications&#34;</span><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details><h2 id=conclusion>Conclusion</h2><p>In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.</p><ul><li><p><strong>Regular spans</strong> were correctly routed to <code>gateway-traces-standard.out</code>, confirming that spans without a matching <code>deployment.environment</code> attribute follow the default pipeline.</p></li><li><p><strong>Security-related spans</strong> were routed to <code>gateway-traces-security.out</code>, demonstrating that the routing rule based on <code>"deployment.environment": "security-applications"</code> works as expected.</p></li></ul><p>By inspecting the output files, we confirmed that the OpenTelemetry Collector <em>correctly evaluates span attributes and routes them to the appropriate destinations</em>. This validates that routing rules can effectively separate and direct telemetry data for different use cases.</p><p>You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 9, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=wrap-up>Wrap-up</h1><p><a href=#R-image-ae80723f89890876dcc1fc6d5b16aaf8 class=lightbox-link><img alt="Well done" class="lazy lightbox figure-image" loading=lazy src=../images/welldone.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ae80723f89890876dcc1fc6d5b16aaf8><img alt="Well done" class="lazy lightbox lightbox-image" loading=lazy src=../images/welldone.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 6, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.95/js/js-yaml/js-yaml.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-color.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-dispatch.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-drag.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-ease.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-interpolate.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-selection.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-timer.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-transition.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/d3/d3-zoom.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/mermaid/mermaid.min.js?1751388568 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v5.95/js/clipboard/clipboard.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/perfect-scrollbar/perfect-scrollbar.min.js?1751388568 defer></script><script src=/observability-workshop/v5.95/js/theme.min.js?1751388568 defer></script></body></html>